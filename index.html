<!DOCTYPE html>
<html xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Music in the Second Empire Theatre</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/vue-multiselect.min.css" rel="stylesheet">
    <link href="css/theme.min.css" rel="stylesheet">
    <link href="css/site.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="./js/html5shiv.min.js"></script>
    <script src="./js/respond.min.js"></script>
    <![endif]-->

    <script src="js/theme.min.js"></script>
    <script src="local.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/loader.js"></script>
</head>
<body>
<div class="container" id='page'>

  <div class="row account">
    <div class="col">
            
      <a id="toolbar-launch" title="Launch the Accessibility Toolbar to adjust this webpage, have it read aloud and other functions." href="javascript:(function(){d=document;jf=d.createElement('script');jf.src=('https:'==document.location.protocol?'https://ssl.atbar.org/c':'http://c.atbar.org')+'/ATBar2/ATBar.min.user.js';jf.type='text/javascript';jf.id='ToolBar';d.getElementsByTagName('head')[0].appendChild(jf);})();">Accessibility Tools</a>
      
    </div>
  </div>
  <div class="row small branding">
    <div class="col">
      <h1><a href="/" name="servicetitle" id="servicetitle">Erddig</a></h1>
      Music. In Wales. I think.
    </div>
  </div>

  <div id="app" class="content"></div>

</div>

<script type="text/x-template" id="templateApp">
    <div>
    <template v-if="app_status == 'dev'">
        <div class="row content">
        <div class="col">
        <div class="card bg-warning my-2">
          <div class="card-body text-center">
             This is a development instance of this service.
             <br />
             {{ git_info.branch }}_{{ git_info.commit_date | formatDate }}_{{ git_info.commit_id }}
          </div>
        </div>
        </div>
        </div>
    </template>
    <template v-if="app_status == 'pprd'">
        <div class="row content">
        <div class="col">
        <div class="card bg-warning my-2">
          <div class="card-body text-center">
             This is the pre-production instance of this service.
             <br />
             {{ git_info.branch }}_{{ git_info.commit_date | formatDate }}_{{ git_info.commit_id }}
          </div>
        </div>
        </div>
        </div>
    </template>
    
    <template v-if="source_data.status == 'ERROR'">
        <div class="row content">
        <div class="col">
        <div class="card bg-error my-2">
          <div class="card-body text-center">
            <h2>Unable to load data</h2>
            <p>An error has occurred. The error was: {{ source_data.error_message }}.</p>
          </div>
        </div>
        </div>
        </div>
    </template>
    <template v-if="source_data.status == 'LOADING'">
        <div class="row content">
        <div class="col">
        <div class="card bg-primary text-white my-2">
          <div class="card-body text-center">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p>Please wait while the data loads.</p>
          </div>
        </div>
        </div>
        </div>
    </template>
    <template v-if="source_data.status == 'OK'">
        <dataset v-bind:dataset="defaultDataset"></dataset>
    </template>
    </div>
</script>

<script type="text/x-template" id="templateDataset">
    <div class="row content">
        <div class="col">
    <div class="container">
        <nav class="row">
            <nav class="col">
                <p>
                    <router-link to="/">Return to search results</router-link>
                    |
                    <router-link to="/data">Dataset schema and download</router-link>
                </p>
            </nav>
        </nav>
        <router-view></router-view>
    </div>
    </div>
    </div>
</script>

<script type="text/x-template" id="templateHome">
    <form v-on:keypress.enter.prevent="ignoreEnter">
        <p>
Intro goes here
        </p>
        <div class="row">
            <div class="col text-sm-right pb-3 pt-3">
                <button v-on:click="resetFilters" class="btn btn-secondary btn-sm">New search</button>
            </div>
        </div>
        <div class="row">
        <div class="col text-sm-right">
            <div class="switch switch-sm">
                <input v-model="options.show_all_filters" type="checkbox" class="switch" id="show-all-filters-upper" />
                <label for="show-all-filters-upper">Advanced search</label>
            </div>
        </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <filter-form v-bind:filters="visible_filters"></filter-form>
            </div>
        </div>
        <div class="row" v-if="options.show_all_filters">
            <div class="col text-sm-right pb-3 pt-3">
                <button v-on:click="resetFilters" class="btn btn-secondary btn-sm">New search</button>
            </div>
        </div>

        <div class="row mb-1">
            <div class="col-sm-6">
                Order results by 
                <select v-model="options.sort_field"><option v-for="field in options.sort_fields" v-bind:value="field.id">{{field.label}}</option></select>
                <select v-model="options.sort_dir"><option value="asc">Ascending</option><option value="desc">Decending</option></select>
            </div>
            <div class="col-sm-6 text-sm-right">
                <div class="switch switch-sm" v-if="options.show_all_filters">
                  <input v-model="options.show_all_filters" type="checkbox" class="switch" id="show-all-filters-lower" />
                  <label for="show-all-filters-lower">Show all filters</label>
                </div>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <results v-bind:options="options" v-bind:results="filteredAndSortedResults"></results>
            </div>
        </div>
    </form>
</script>

<script type="text/x-template" id="templateResults">
    <div>
        <div v-if="results.length == 0" class="card mb-1">
            <div class="card-body">No records match your filter terms.</div>
        </div>

        <div v-else>
            <results-summary v-bind:results="results" v-bind:options="options" v-bind:visible_records_count="visible_records.length"></results-summary>
            <div v-for="record in visible_records">
                <summary-card v-bind:record="record"></summary-card>
            </div>
            <div class="floating-summary">
                <results-summary v-bind:results="results" v-bind:options="options" v-bind:visible_records_count="visible_records.length"></results-summary>
            </div>
        </div>

    </div>
</script>

<script type="text/x-template" id="templateResultsSummary">
    <div class="result-summary">
        <div class="card mb-1">
            <div class="card-body">
                <div>
                    <div v-if="visible_records_count==results.length" class="record-count">Showing all {{ visible_records_count }} matching records.</div>
                    <div v-else class="record-count">Showing first {{ visible_records_count }} of {{ results.length }} matching records.</div>
                    <div class="switch switch-sm">
                        <input v-model="options.show_all_results" type="checkbox" class="switch" id="show-all-results" />
                        <label for="show-all-results">Show all matches</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" id="templateFilterForm">
    <div class='filter-form'>
        <div v-for="filter in filters" :key="filter.field.id" class="form-row mb-1">
            <div class="col-sm-2 text-sm-right">
                <label v-if="filter.field.description != null" data-toggle="tooltip" v-bind:title="filter.field.description" v-bind:for="'filter-'+filter.field.id">{{filter.field.label}}</label>
                <label v-else v-bind:for="'filter-'+filter.field.id">{{filter.field.label}}</label>
            </div>
            <template v-if="filter.field.type=='text'">
                <div class="col-sm-2">
                    <select v-model.trim="filter.mode" class="form-control form-control-sm">
                        <option value="is">is</option>
                        <option value="contains">contains</option>
                        <option value="set">is present</option>
                        <option value="not-set">is not present</option>
                    </select>
                </div>
                <div class="col-sm-8">
                    <template v-if="filter.mode=='is' || filter.mode=='contains'">
                        <debounced-input v-bind:type="'text'" v-bind:id="'filter-'+filter.field.id" v-model.trim="filter.term" v-bind:placeholder="filter.placeholder[filter.mode]" class="form-control form-control-sm"></debounced-input>
                    </template>
                </div>
            </template>
            <template v-else-if="filter.field.type=='integer'">
                <div class="col-sm-2">
                    <select v-model.trim="filter.mode" class="form-control form-control-sm">
                        <option value="is">is</option>
                        <option value="between">is between</option>
                        <option value="set">is present</option>
                        <option value="not-set">is not present</option>
                    </select>
                </div>
                <div class="col-sm-8">
                    <template v-if="filter.mode=='is'">
                        <debounced-input v-bind:type="'number'" v-bind:id="'filter-'+filter.field.id" v-model.trim="filter.term" v-bind:placeholder="filter.placeholder.is" class="form-control form-control-sm" v-bind:min="filter.field.min" v-bind:max="filter.field.max"></debounced-input>
                    </template>
                    <template v-if="filter.mode=='between'">
                        <debounced-input v-bind:type="'number'" v-bind:id="'filter-'+filter.field.id" v-model.number="filter.term" v-bind:placeholder="filter.placeholder.between[0]" class="form-control form-control-sm between-number-filter" v-bind:min="filter.field.min" v-bind:max="filter.field.max"></debounced-input>
                        and
                        <debounced-input v-bind:type="'number'" v-bind:id="'filter-'+filter.field.id" v-model.number="filter.term2" v-bind:placeholder="filter.placeholder.between[1]"  class="form-control form-control-sm between-number-filter" v-bind:min="filter.field.min" v-bind:max="filter.field.max"></debounced-input> 
                    </template>
                </div>
            </template>
            <template v-else-if="filter.field.type=='date'">
                <div class="col-sm-2">
                    <select v-model.trim="filter.mode" class="form-control form-control-sm" v-bind:id="'filter-'+filter.field.id">
                        <option value="is">is</option>
                        <option value="between">is between</option>
                        <option value="set">is present</option>
                        <option value="not-set">is not present</option>
                    </select>
                </div>
                <div class="col-sm-8">
                    <template v-if="filter.mode=='is'">
                        <debounced-input v-bind:type="'text'" v-model.trim="filter.term" v-bind:placeholder="filter.placeholder.is" class="form-control form-control-sm" v-bind:id="'filter-'+filter.field.id"></debounced-input>
                    </template>
                    <template v-if="filter.mode=='between'">
                        <debounced-input v-bind:type="'text'" v-model.trim="filter.term" v-bind:placeholder="filter.placeholder.between[0]" class="form-control form-control-sm between-number-filter" v-bind:id="'filter-to-'+filter.field.id"></debounced-input>
                        and
                        <debounced-input v-bind:type="'text'" v-model.trim="filter.term2" v-bind:placeholder="filter.placeholder.between[1]" class="form-control form-control-sm between-number-filter" v-bind:id="'filter-from-'+filter.field.id"></debounced-input>
                    </template>
                </div>
            </template>
            <template v-else-if="filter.field.type=='enum'">
                <div class="col-sm-2">
                    <select v-model.trim="filter.mode" class="form-control form-control-sm">
                        <option value="is">is</option>
                        <option value="one-of">one of</option>
                        <option value="set">is present</option>
                        <option value="not-set">is not present</option>
                    </select>
                </div>
                <div class="col-sm-8">
                    <template v-if="filter.mode=='is'">
                        <select v-model="filter.term" class="form-control form-control-sm" v-bind:id="'filter-'+filter.field.id">
                            <option selected="selected" value="">Select</option>
                            <option v-for="option in filter.field.options" v-bind:value="option">{{ option }}</option>
                        </select>
                    </template>
                    <template v-if="filter.mode=='one-of'">
                        <multiselect v-model="filter.terms" :options="filter.field.multiselectOptions" :multiple="true" :close-on-select="true" :clear-on-select="false" :preserve-search="true" placeholder="Pick some" label="name" track-by="name" >
                            <template slot="tag" slot-scope="{ option, remove }"><span class="custom__tag"><span>{{ option.name }}</span><span class="custom__remove" @click="remove(option)">❌</span></span></template>
                        </multiselect>
                    </template>
                </div>
            </template>
            <template v-else-if="filter.field.type=='freetext'">
                <div class="col-sm-10">
                    <debounced-input v-bind:type="'text'" v-model.trim="filter.term" class="form-control form-control-sm" v-bind:id="'filter-'+filter.field.id"></debounced-input>
                </div>
            </template>
            <template v-else>
                <div class="col-sm-10">
                   Unknown filter type.
                </div>
            </template>
        </div>
    </div>
</script>

<script type="text/x-template" id="templateData">
    <div class="row">
        <div class="col">
            <h2>About the data</h2>
            <p>This dataset has been created and shared with the intention it should be reused. The fields in the
                dataset are described below.</p>
            <p>This data is copyright <a v-bind:href="dataset.config.copyright.url">{{ dataset.config.copyright.name }}</a> and may be reused under the <a v-bind:href="dataset.config.license.url">{{ dataset.config.license.name }}</a> license.</p>
            <p>This dataset was created by <span v-for="(creator, index) in dataset.config.creators"><span>{{ creator.name }}</span><span v-if="index+1 < dataset.config.creators.length">, </span></span>.</p>
            <p>If using this data, please attribute it as "{{ dataset.config.attribution.text }}" with a link to <a v-bind:href="dataset.config.attribution.url">{{dataset.config.attribution.url}}</a>.</p>
            <p>
                <button v-on:click="downloadJSON" class="btn btn-secondary">Download JSON</button>
                <button v-on:click="downloadCSV" class="btn btn-secondary">Download CSV</button>
            </p>
            <h2>About this software</h2>
            <p>This website uses pure Javascript to provide interaction with a JSON datafile which contains the records and site configuration. It does not require any database or PHP -- all the searching is done inside the single page. Our working title for the toolkit to make this happen is <i>DATA CAPE</i>. In theory it could be reused for similar projects in future. DATA CAPE, and this website (OPERA CAPE), were created by <a href="https://www.ecs.soton.ac.uk/people/totl">Christopher Gutteridge</a> and David Pepper in the iSolutions Web & Data Innovation team.</p>
            <h2>Schema</h2>
            <p>Field types may be text, date, integer or enum. An enum field is short for enumerated, which means a
                limited set of terms rather than free text.</p>
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Field id</th>
                    <th scope="col">Field name</th>
                    <th scope="col">Field type</th>
                    <th scope="col">Description</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="field in dataset.config.fields">
                    <td>{{ field.id }}</td>
                    <td>{{ field.label }}</td>
                    <td>{{ field.type }} <span v-if="field.multiple"> list</span></td>
                    <td>{{ field.description }}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</script>

<script type="text/x-template" id="templateRecord">
    <div>
        <div class="row">
            <div class="col">
                <index-card v-if="dataset.records_by_id[ $route.params.id ]"
                            v-bind:record="dataset.records_by_id[ $route.params.id ]"></index-card>
                <div v-else>
                    <p>NO SUCH RECORD</p>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" id="templateFieldLabelAndValueIfSet">
      <field-label-and-value v-if="typedValue.value != '' && typedValue.value != null && !(typeof typedValue.value=='array' && typedValue.value.length==0)" v-bind:typedValue="typedValue"></field-label-and-value>
</script>

<script type="text/x-template" id="templateFieldLabelAndValue">
    <div class="field-label-and-value">
      <template v-if="typedValue.field.value != ''">
        <div class="field-label" v-if="typedValue.field.description != null" data-toggle="tooltip" v-bind:title="typedValue.field.description">{{typedValue.field.label}}</div>
        <div class="field-label" v-else>{{typedValue.field.label}}</div>
        <field-value v-bind:typedValue="typedValue"></field-value>
      </template>
    </div>
</script>

<script type="text/x-template" id="templateSummaryCard">
    <div class="summary-card card mb-1">
            <div class="card-body" v-on:click="showIndexCard" title="See full details.">
                <div class="row pb-1">
                    <div class="col-sm-8 card-title">
                        <field-value v-bind:linkValue="false" v-bind:typedValue="record.title"></field-value>
                    </div>
                    <div class="col-sm-4 text-sm-right">
                        <field-value v-bind:linkValue="false" v-bind:typedValue="record.date"></field-value>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <template v-if="record.composer.value != null && record.composer.value.length>0">
                            <field-value v-bind:linkValue="false" v-bind:typedValue="record.composer"></field-value> <span class='label-note'>(composer)</span>
                        </template>
                    </div>

                </div>
            </div>

    </div>
</script>

<script type="text/x-template" id="templateIndexCard">
    <div>
        <div class="index-card-nav">
            <a v-if="record.prev" v-bind:href="'#/record/'+record.prev">⬅️&nbsp;Previous</a>
            &nbsp;
            <a v-if="record.next" style='float:right;display:inline-block' v-bind:href="'#/record/'+record.next">Next&nbsp;➡️</a>
        </div>
    <div class="card index-card mb-2">
        <div class="card-body">
            <h5 class="card-title">
                <field-value v-bind:linkValue="false" v-bind:typedValue="record.title"></field-value>
            </h5>

            <div class="row">
                <div class="col-md">
                    <field-label-and-value-if-set v-bind:typedValue="record.date"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.title"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.work"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.derivative_work"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.date_of_derivative_work"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.source"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.composer"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.composer_dates"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.arranger"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.arranger_dates"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.librettist_lyricist"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.librettist_lyricist_dates"></field-label-and-value-if-set>
                </div>
                <div class="col-md">
                    <field-label-and-value-if-set v-bind:typedValue="record.publication_details"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.publication_used"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.date_of_publication"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.plate_publication_numbers"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.sources_for_publication_dates"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.shelfmark_original"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.shelfmark_2013"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.nt_number"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.instrument"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.instrument_owner"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.performers"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.recording_location"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.recording_date"</field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.tags"></field-label-and-value-if-set>
                    <field-label-and-value-if-set v-bind:typedValue="record.notes"></field-label-and-value-if-set>
                </div>
            </div>

        </div>
    </div>
    </div>
    </div>
    </div>
</script>

<script type="text/x-template" id="templateDebouncedInput">
    <input v-bind:placeholder="input_placeholder" v-bind:type="input_type" v-bind:value="input_value" v-bind:id="input_id" v-on:input="debounce_input">
</script>

</body>
</html>

